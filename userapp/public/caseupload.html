<!DOCTYPE html>
<html lang="en">


<head>
    
    <!-- Meta -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, minimal-ui, viewport-fit=cover">
	<meta name="theme-color" content="#2196f3">
	<meta name="author" content="DexignZone" /> 
    <meta name="keywords" content="" /> 
    <meta name="robots" content="" /> 
	<meta name="description" content="PraniCure - Animal Helpline App"/>
	<meta property="og:title" content="PraniCure - Animal Helpline App" />
	<meta property="og:description" content="PraniCure - Animal Helpline App" />
	<meta name="format-detection" content="telephone=no">
    
    <!-- Favicons Icon -->
	<link rel="shortcut icon" type="image/x-icon" href="assets/images/whitelogo.png" />
    
    <!-- Title -->
	<title>PraniCure - Animal Helpline App</title>
	
    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/vendor/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="assets/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&amp;family=Roboto+Slab:wght@100;300;500;600;800&amp;display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <!-- Load TensorFlow.js. This is required to use coco-ssd model. -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"> </script>

<!-- Load the coco-ssd model. -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"> </script>

<script src="https://code.jquery.com/jquery-3.6.2.slim.min.js" integrity="sha256-E3P3OaTZH+HlEM7f1gdAT3lHAn4nWBZXuYe89DFg2d0=" crossorigin="anonymous"></script>

</head>   

<style>
    .cont{
    background-color: #ffffff;
    width: 60%;
    min-width: 450px;
    position: relative;
    margin:  50px auto;
    padding: 50px 20px;
    border-radius: 7px;
    box-shadow: 0 20px 35px rgba(0,0,0,0.05);
}
input[type="file"]{
    display: none;
}
.label{
    display: block;
    position: relative;
    background-color: #ffffff;
    border: 1px solid rgb(59, 59, 59);
    color: #424242;
    font-size: 15px;
    text-align: center;
    width: 300px;
    padding: 5px 0;
    margin: auto;
    border-radius: 5px;
    cursor: pointer;
}
.cont p{
    text-align: center;
    margin: 20px 0 30px 0;
}
#images{
    width: 85%;
    position: relative;
    margin: auto;
    display: flex;
    justify-content: space-evenly;
    gap: 5px;
   
}
.images{
    width: 33%;
    position: relative;
    margin: auto;
    display: flex;
    justify-content: space-evenly;
    gap: 5px;
}
.images>img{
    object-fit: contain;
}

figcaption{
    text-align: center;
    font-size: 2.4vmin;
    margin-top: 0.5vmin;
}


</style>
<body class="bg-white">
<div class="page-wraper">
    
    <!-- Preloader -->
    <div id="preloader">
        <div class="spinner"></div>
    </div>
    <!-- Preloader end-->    
    
	<!-- Header -->
    <header class="header">
        <div class="main-bar">
            <div class="container">
                <div class="header-content">
                    <div class="left-content w-auto">
                        <a href="javascript:void(0);" class="back-btn">
                            <svg width="18" height="18" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9.03033 0.46967C9.2966 0.735936 9.3208 1.1526 9.10295 1.44621L9.03033 1.53033L2.561 8L9.03033 14.4697C9.2966 14.7359 9.3208 15.1526 9.10295 15.4462L9.03033 15.5303C8.76406 15.7966 8.3474 15.8208 8.05379 15.6029L7.96967 15.5303L0.96967 8.53033C0.703403 8.26406 0.679197 7.8474 0.897052 7.55379L0.96967 7.46967L7.96967 0.46967C8.26256 0.176777 8.73744 0.176777 9.03033 0.46967Z" fill="#a19fa8"/>
							</svg>
                        </a>
                        <h5 class="mb-0 ms-3">Case Upload</h5>
                    </div>
                    <div class="mid-content">
                    </div>
                    <div class="right-content">
                        
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header End -->
	
    <!-- Sidebar -->
    
    
    <!-- Page content -->
    <div class="page-content">
        <div class="container fb">
            <input type="file" id="picfile" name="picfile" accept="image/png, image/jpeg"  multiple>
                <label class="label" for="picfile">
                    <i class="fas fa-upload"></i> &nbsp; Select photos
                </label>
                <br>
                <p id="num-of-files">No Files Chosen</p>
                <div class="images">

                </div>
                <button type="button" class="btn btn-primary w-100" id="fileuploder">Upload</button>
                <a id="seloc" class="btn btn-secondary mb-3 font-15 p-2 mt-2 d-flex align-items-center btn-block">
                    <i class='fas fa-location-arrow' style='font-size:24px;color:white;'></i> &nbsp;Select Location</a>
                    <div class="mb-2 input-group input-radius" id="location" data-lat="" data-lon="">
                    
                        <input disabled type="text" class="form-control" placeholder="" required>
                    </div>
                    <div class="mb-2 input-group input-radius">
                    
                        <input type="text" id="title" class="form-control" placeholder="Case title eg. Injured cat near BEL Road..." required>
                    </div>

                    <div class="input-group mb-2 input-radius">
                        <textarea class="form-control" id="desp" placeholder="Case description, it'll help judge the case better" rows="4" required></textarea>
                    </div>

                    <div class="mb-2 input-group input-radius">
                        <span class="input-group-text"><i class="fa-solid fa-phone"></i></span>
                        <input type="number" id="phone" class="form-control" placeholder="Phone number" required>
                    </div>

                    <div class="card-body pb-0">
                        <label class="mb-2">
                            <h5>Animal Type</h5>
                        </label>
                        <div class="radio circle-radio">
                            <label class="radio-label">Pet
                                <input type="radio" checked="checked" value="0" name="radio1">
                                <span class="checkmark"></span>
                            </label>
                            <label class="radio-label">Stray
                                <input type="radio" value="1" name="radio1">
                                <span class="checkmark"></span>
                            </label> 
                        </div>
                    </div>
                    <div class="card-body">
                        <label class="mb-2">
                            <h5>Priority</h5>
                        </label>
                        <div class="radio circle-radio">
                            <label class="radio-label">Emergency
                                <input type="radio"value="1" checked="checked" name="radio2">
                                <span class="checkmark"></span>
                            </label>
                            <label class="radio-label">Urgent
                                <input type="radio" value="2" name="radio2">
                                <span class="checkmark"></span>
                            </label>
                            <label class="radio-label">Not Urgent
                                <input type="radio"  value="3" name="radio2">
                                <span class="checkmark"></span>
                            </label>
                            
                        </div>
                    </div>






        </div>
            
        </div>
		<div class="footer fixed ">
			<div class="container">
				<div class="footer-btn d-flex align-items-center">
					<a id="post" class="btn btn-primary btn-rounded flex-1 ms-2">POST CASE</a>
				</div>
			</div>
		</div>		
    </div>
    <!-- Page content End-->

	<!-- Theme Color Settings End -->
    <!-- Footer -->
	<!-- <div class="footer fixed">
		<div class="container">
			
		</div>
	</div> -->
</div>
<!--**********************************
    Scripts
***********************************-->
<script>
    $(document).ready(function(){

     var ulat="";
    var ulon="";
$("#location").slideUp();
$("#seloc").on("click",function(){
   
    getUserLocation()
   
})

async function getUserLocation() {
  if ('geolocation' in navigator) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
     ulat = position.coords.latitude;
      ulon = position.coords.longitude;
      alert(ulat)
      alert(ulon)
      const options = {method: 'GET'};

fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${ulat}&lon=${ulon}`, options)
  .then(response => response.json())
  .then(function(response){console.log(response)
    $("#location").slideDown();
    $("#location").html(response.display_name);
    $("#location").data("lat",ulat);
    $("#location").data("lon",ulon);

})
  .catch(err => console.error(err));
     
        console.log('Latitude:', latitude);
        console.log('Longitude:', longitude);
      },
      function(error) {
        if (error.code === error.PERMISSION_DENIED) {
          console.error('Location permission denied.');
        } else {
          console.error('Error:', error.message);
        }
        
        // Prompt again for location
        // getUserLocation();
      }
    );
  } else {
    console.error('Geolocation is not supported by this browser.');
  }
}
        
    })

    $("#post").on("click",function(){
        var type = $('input[name="radio1"]:checked').val();
        var priority = $('input[name="radio2"]:checked').val();
        var title=$("#title").val()
        var desp=$("#desp").val()
        var phone=$("#phone").val()
       var address= $("#location").html()
        if(title==''){
            // tosat
            alert("title")
            return
        }
        if(address==''){
            // tosat
            alert("address")
            return
        }
        if(desp==''){
            // tosat
            alert("desp")
            return
        }
        if(phone==''){
            // tosat
            alert("phonr")
            return
        }
        // if(!(is_Animal) && true){
        if(false){
            alert("not animal")
            return

}
let uid=localStorage.getItem("prani");
  let id=uid.split('-')
  var digits='1234567890'
var otp=''


for (let j = 0; j < 6; j++) {
  otp += digits[Math.floor(Math.random() * 10)];
}
$.ajax({
    url:"http://localhost:9000/caseupload",
    type:"post",
    dataType: "json",
    data: { user:id[0],caseid: otp, photo:img_array.join(','),titl:title,desc:desp,phon:phone,pri: priority,ty:type,add:address,status:1,lat:$("#location").data("lat"),long:$("#location").data("lon")
    },
    
    success: function(res){
        if(res.status==200){
          alert("inserted")

    
          console.log(res)
          
        
         }
        else if(res.status==500){
          console.log(res)
        }
    }
})


        alert(type)
        alert(priority)

    })



</script>
<script>
   

  // Multiple images preview in browser
  var imagesPreview = function(input, placeToInsertImagePreview) {
    if (input.files) {
      var filesAmount = input.files.length;
      alert(99)

      for (var i = 0; i < filesAmount; i++) {
        var reader = new FileReader();

        reader.onload = function(event) {
          $($.parseHTML('<img>')).attr('src', event.target.result).appendTo(placeToInsertImagePreview);
         
        };

        reader.readAsDataURL(input.files[i]);
      }
    }
  };
  var formData="";
  var filesName ="";
  const input = document.querySelector("input[type=file]");
const files = input.files;
  $('#picfile').change( async function() {
   
   
    // formData.append("picfile", picfile.files[0]);
 filesName = $('#picfile')[0].files;
    var error = '';


    for (var count = 0; count < filesName.length; count++) {
      var name = filesName[count].name;
      var extension = name.split('.').pop().toLowerCase();
    //   var numOfFiles = formData.getAll("files[]").length;
    //  alert(9)
      
      if (jQuery.inArray(extension, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
        error += "Invalid " + count + " Image File";
      } else {
        if(filesName.length>4)
        {
            alert('Maximum 3 images can be uploaded.');
            return;
        }
    }
 

} 
  

    if (error == '') {
      imagesPreview(this, 'div.images');
      var nofiles = filesName.length;
      $('#num-of-files').text(nofiles + (nofiles > 1 ? ' Files Selected' : ' File Selected'));
    } else {
      alert(error);
    }

    
  });

 var is_animal=1
var img_array;
  $("#fileuploder").on("click",async function(){
alert(0)
const files = $("#picfile")[0].files;

const formData = new FormData();
    
    for (let i = 0; i < files.length; i++) {
      formData.append("picfile", files[i]);
    }
    
    try {
      const response = await fetch('http://localhost:9000/uploadmultiple', {
        method: "POST",
        body: formData
      });
      
      const json = await response.json();
      
      if (json.status === 200) {
        img_array=json.response
      let i=0
for( let item of  img_array){
    let path=item.split('incidentimages')
    img_array[i]=`incidentimages${path[1]}`
i++
    console.log(path[1])
 
        await cocoSsd.load().then(model => {
    //   Load the image.
      const img = new Image();
      console.log(`incidentimages${path[1]}`)
      img.src = `incidentimages/pug.jpg`; // Replace with the path to your image file.
  
      // When the image is loaded, perform object detection.
      img.onload = () => {
        console.time("test_timer");
        // Detect objects in the image.
      model.detect(img).then(async predictions => {
          console.timeEnd("test_timer");
          const animalClasses = ['bird', 'cat', 'dog', 'horse','elephant']; // Array of most common animal classes
     const detectedClasses = predictions.map( async prediction => prediction.class);
  
          // Check if any of the detected classes are present in the animalClasses array
         const isAnimal = detectedClasses.some(cls => animalClasses.includes(cls));
  
          console.log('Is animal:', isAnimal);
          if(!isAnimal){
            is_Animal=0

          }

        });
      };
    });
}

// console.log(json.response)

        alert("Files uploaded successfully!");
      } else {
        alert("An error occurred during file upload.");
      }
    } catch (error) {
      console.error("Error:", error);
    }
   

               




   
   

 
        // console.log(form_data.getAll("files[]"));
  })


//   $('#upload').on('click', function() {
//     var numOfFiles = form_data.getAll("files[]").length;
//     alert("Total " + numOfFiles + (numOfFiles > 1 ? ' Files Selected' : ' File Selected'));
//   });



</script>


<script src="assets/js/jquery.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/dz.carousel.js"></script><!-- Swiper -->
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script><!-- Swiper -->
<script src="assets/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script><!-- Swiper -->
<script src="assets/js/settings.js"></script>
<script src="assets/js/custom.js"></script>
<!-- <script src="multi-image.js"></script> -->
<script>
    $(".stepper").TouchSpin();
</script>
</body>


</html>